#!/bin/bash

# Script de d√©ploiement pour corriger l'erreur 404 device_model_services
# Ce script applique la migration compl√®te avec v√©rification

echo "üöÄ Correction de l'erreur 404 - Table device_model_services manquante"
echo ""

# V√©rifier que le fichier SQL existe
if [ ! -f "check_and_create_device_model_services.sql" ]; then
    echo "‚ùå Erreur: Le fichier check_and_create_device_model_services.sql n'existe pas"
    exit 1
fi

echo "üìã Instructions pour appliquer la correction:"
echo ""
echo "1. Connectez-vous √† votre dashboard Supabase:"
echo "   https://supabase.com/dashboard"
echo ""
echo "2. S√©lectionnez votre projet"
echo ""
echo "3. Allez dans l'√©diteur SQL (SQL Editor)"
echo ""
echo "4. Copiez le contenu du fichier 'check_and_create_device_model_services.sql'"
echo ""
echo "5. Collez-le dans l'√©diteur SQL"
echo ""
echo "6. Cliquez sur 'Run' pour ex√©cuter le script"
echo ""
echo "7. V√©rifiez que vous voyez les messages de succ√®s:"
echo "   ‚úÖ Table device_model_services existe"
echo "   ‚úÖ Vue device_model_services_detailed existe"
echo "   ‚úÖ Politiques RLS configur√©es"
echo ""
echo "‚úÖ Apr√®s l'ex√©cution, l'erreur 404 devrait √™tre r√©solue"
echo ""
echo "üìÅ Fichier SQL √† utiliser: check_and_create_device_model_services.sql"
echo ""
echo "üîß Ce script fait tout automatiquement:"
echo "   - V√©rifie si la table existe"
echo "   - Cr√©e la table si n√©cessaire"
echo "   - Cr√©e tous les index"
echo "   - Configure les politiques RLS"
echo "   - Cr√©e la vue d√©taill√©e"
echo "   - Cr√©e les fonctions RPC"
echo "   - Cr√©e le trigger updated_at"
echo "   - V√©rifie que tout fonctionne"
echo ""
echo "‚ö†Ô∏è  Pr√©requis: Les tables suivantes doivent exister:"
echo "   - device_models"
echo "   - services"
echo "   - device_brands"
echo "   - device_categories"
echo "   - workshops (optionnel)"
echo ""
echo "üéØ Une fois le script ex√©cut√©, l'application devrait fonctionner sans erreur 404"
echo ""
echo "üß™ Pour tester apr√®s l'ex√©cution:"
echo "   1. Rechargez votre application"
echo "   2. Essayez de cr√©er une association service-mod√®le"
echo "   3. V√©rifiez qu'il n'y a plus d'erreur 404 dans la console"
